## library
library(tidyverse)
## import and pre-process cohort data
df_input <- read_csv(
here::here("output", "input.csv"))
library(here)
## import and pre-process cohort data
df_input <- read_csv(
here::here("output", "input.csv"))
View(df_input)
df_cleaned <- df_input %>%
mutate(GroupVidClinic_had=ifelse(is.na(GroupVidClinic_had)|GroupVidClinic_instance==0,0,1))
df_cleaned <- df_input %>%
mutate(GroupVidClinic_had=ifelse(is.na(GroupVidClinic_instance)|GroupVidClinic_instance==0,0,1))
df_to_tbrates <- function(mydf,myvars,flag_save=0,tb_name="latest") {
mytb=
mydf %>%
group_by_at(myvars) %>%
summarise(
population=n(),
GroupVidClinic_covg=sum(GroupVidClinic_had,na.rm=T),
GroupVidClinic_count=sum(GroupVidClinic_instance,na.rm=T),
)
if (flag_save){
write.csv(mytb,paste0(here::here("output","tables"),"/",tb_name,".csv"))
}
return(mytb)
}
## OC and GP rates per practice
tb01_tally_practice <- df_to_tbrates(df_cleaned,c("practice"),1,"tb01_gpcr_region")
## OC and GP rates per STP
tb02_gpcr_stp <- df_to_tbrates(df_cleaned,c("stp"),1,"tb02_gpcr_stp")
mytb=
mydf %>%
group_by_at("practice") %>%
summarise(
population=n(),
GroupVidClinic_covg=sum(GroupVidClinic_had,na.rm=T),
GroupVidClinic_count=sum(GroupVidClinic_instance,na.rm=T),
)
mytb=
df_cleaned %>%
group_by_at("practice") %>%
summarise(
population=n(),
GroupVidClinic_covg=sum(GroupVidClinic_had,na.rm=T),
GroupVidClinic_count=sum(GroupVidClinic_instance,na.rm=T),
)
df_to_tbrates <- function(mydf,myvars,flag_save=0,tb_name="latest") {
mytb=
mydf %>%
group_by_at(myvars) %>%
summarise(
population=n(),
GroupVidClinic_covg=sum(GroupVidClinic_had,na.rm=T),
GroupVidClinic_count=sum(GroupVidClinic_instance,na.rm=T),
)
if (flag_save){
write.csv(mytb,paste0(here::here("output"),"/",tb_name,".csv"))
}
return(mytb)
}
## OC and GP rates per practice
tb01_tally_practice <- df_to_tbrates(df_cleaned,c("practice"),1,"tb01_gpcr_region")
## OC and GP rates per STP
tb02_gpcr_stp <- df_to_tbrates(df_cleaned,c("stp"),1,"tb02_gpcr_stp")
## OC and GP rates per STP
tb02_tally_stp <- df_to_tbrates(df_cleaned,c("stp"),1,"tb02_gpcr_stp")
View(tb01_tally_practice)
View(tb01_tally_stp)
View(tb02_tally_stp)
